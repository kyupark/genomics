//============================================================================
// Name        : TeaQ.cpp
// Author      :
// Version     :
// Copyright   : Your copyright notice
// Description : Hello World in C++, Ansi-style
//============================================================================

// #include <iostream>
//#include <bwtaln.h>
#include "ReadClipper.hpp"
#include <cstdlib>

using namespace TeaQ;
using namespace std;

int main(int argc, char *argv[]) {
	if (argc < 1) {
		cerr << "usage:\t" << argv[0] << " <bam_file_name> <ref_file_name> <minimum_read_length (default: 5)> <minimum_base_gap (default: 2)> <cap3_options (default = -i 21 -j 31 -o 16 -s 251 -p 70)>" << endl;
		cerr << "\t ref family file (default: /home/el114/kyu/data/bwa_idx/human_youngTE_revisedPolyA.fa)" << endl;
		return 1;
	}
	string bam_file_name = argv[1]; // string bam_file_name = "/home/el114/kyu/data/test.bam";
	string ref_file_name = "/home/el114/kyu/data/bwa_idx/human_youngTE_revisedPolyA.fa";
	int64_t minimum_read_length = 5;
	int64_t minimum_base_gap = 2;
	string cap3_options = "-i 21 -j 31 -o 16 -s 251 -p 70";

	stringstream ss;

	if (argc >= 2) {
		ss.clear();
		ss << argv[2];
		if (!(ss >> ref_file_name)) cerr << "Invalid <ref_file_name>";
	}
	if (argc >= 3) {
		ss.clear();
		ss << argv[3];
		if (!(ss >> minimum_read_length)) cerr << "Invalid <minimum_read_length>";
	}
	if (argc >= 4) {
		ss.clear();
		ss << argv[4];
		if (!(ss >> minimum_base_gap)) cerr << "Invalid <minimum_base_gap>";
	}
	if (argc >= 5) {
		ss.clear();
		for (int i=5; i < argc; ++i) {
			ss << argv[i] << " ";
		}
		if (!(ss >> cap3_options)) cerr << "Invalid <cap3_options>";
	}

	ReadClipper::clip_filter_contiggen(
			bam_file_name,
			ref_file_name,
			minimum_read_length,
			minimum_base_gap,
			cap3_options);

	return 0;
}
